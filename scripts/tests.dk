assert(1)# comments are working
# also at line begining
# assert(0)

print("TEST: assignment")
n=1
assert(n==1)
print("test successful")

print("TEST: arithmetics")
assert(1+1==2)
assert((2*2)==4)
print("test successful")

print("TEST: adding strings")
assert(("John"+" "+"Smith")=="John Smith")
print("test successful")

print("TEST: basic functions")
add=(a, b)->a+b
assert(add(2, 5)==7)
double=n->n*2
assert(double(5)==10)
print("test successful")

test=(name, assertion)->{
    print("TEST: "+name)
    assertion()
    print("test successful")}
test("test helper function", ->assert(1))

test("stack optimisations", ->{
    a=1
    b=5
    c=8
    assert(a+a+b+b+a+c+b==26)
})

global.assert_error=o->{
    assert(o.error)
    o.handled=1
}

test("string functions", ->{
    assert(substring("John", 2, 4)=="hn")
    assert_error(substring("John", -1, 4))
    assert_error(substring("John", 0, 5))
    assert_error(substring("John", "John", 4))
    assert_error(substring("John", 0, "John"))

    assert(string_length("John")==4)
    assert_error(string_length(1))

    assert(to_character(64)=="@")
    assert_error(to_character("@"))
    
    assert(from_character("@")==64)
    assert_error(from_character(64))
})

test("format function", ->{
    assert(format("name: {}, surname: {}", "John", "Doe")=="name: John, surname: Doe")

    # not enough arguments provided to the format function should cause an error
    assert_error(format("name: {}, surname: {}", "John"))
    assert_error(format("name: {}, surname: {}"))

    # incorrectly written braces
    assert(format("name: {, surname: {}", "John", "Doe")=="name: {, surname: John")
    assert(format("name: {, surname: }", "John", "Doe")=="name: {, surname: }")
    assert(format("name: {}, surname: {", "John", "Doe")=="name: John, surname: {")

    # escaping
    assert(format("\{}", 1)=="{}")
    assert(format("\\{}", 1)=="\1")

    # error when first argument is not a string
    assert_error(format(1, 4))
})

test("type casting", ->{
    five=5
    text="5"
    assert(number(text)==five)
    assert(string(five)==text)
    assert(cast(text, 'number)==five)
    assert(cast(five, 'string)==text)
})

test("closures", ->{
    adder=a->{
        one=1
        x->(a+x)*one
    }
    add_two=adder(2)
    assert(add_two(5)==7)
})